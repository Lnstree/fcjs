{"code":"var fcgame=function(t){var i={};function r(s){if(i[s])return i[s].exports;var e=i[s]={i:s,l:!1,exports:{}};return t[s].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=t,r.c=i,r.d=function(t,i,s){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},r.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.t=function(t,i){if(1&i&&(t=r(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var e in t)r.d(s,e,function(i){return t[i]}.bind(null,e));return s},r.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(i,\"a\",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p=\"\",r(r.s=0)}([function(t,i,r){\"use strict\";r.r(i),r.d(i,\"FC_Game\",(function(){return o})),r.d(i,\"FC_Display\",(function(){return c}));var s=r(1),e=r(2),n=r(3),h=r(5),a=function(){this.cpu=new s(this),this.ppu=new e(this),this.cartridge=new n(this)};function o(){return new a}function c(t){return new h(t)}a.prototype.loadFile=function(){},a.prototype.load=function(t){this.cartridge.load(t)},a.prototype.run=function(){setInterval(()=>{nes.cpu.run_frame()},1e3/60)},a.prototype.registerDisplay=function(t){this.ppu.set_display(t)},a.prototype.test=function(){console.log(\"Hello FC Game!\")}},function(t,i){var r=0,s=1,e=2,n=3,h={C:0,Z:1,I:2,D:3,V:6,N:7},a=function(){this.flag=32};a.prototype.get=function(){return this.flag},a.prototype.index=function(t){return!!(this.flag>>t&1)},a.prototype.setFlag=function(t,i){this.flag&=~(1<<t),this.flag|=(i>0)<<t},a.prototype.set=function(t){this.flag=255&(32|t)};var o=new Uint8Array(1),c=new Uint8Array(1),p=new Uint8Array(1),u=new Uint8Array(1),d=new a,f=new Uint16Array(1),y=new Uint8Array(2048),l=function(t){this.nes=t,this.nmi=!1,this.irq=!1,this.remaininhCycles=0};l.prototype.debugInfo=function(){console.log(\"A:\",o[0],\" X\",c[0],\" Y\",p[0],\" S\",u[0]),console.log(\"PC:\",f[0]),console.log(\"flag(\",\"C:\",d.index(h.C),\"Z:\",d.index(h.Z),\"I:\",d.index(h.I),\"D:\",d.index(h.D),\"V:\",d.index(h.V),\"N:\",d.index(h.N),\")\"),console.log(\"nmi:\",this.nmi),console.log(\"irq:\",this.irq),console.log(\"cycles:\",this.remaininhCycles),console.log(\"--------------------------------------------------\")},l.prototype.set_nmi=function(t=!0){this.nmi=nmi=t},l.prototype.set_irq=function(t=ture){this.irq=t},l.prototype.dmc_read=function(t){return this.access(0,t)},l.prototype.elapsed=function(){return 29781-this.remaininhCycles},l.prototype.tick=function(){this.nes.ppu.step(),this.nes.ppu.step(),this.nes.ppu.step(),this.remaininhCycles--},l.prototype.upd_cv=function(t,i,r){d.setFlag(h.C,r>255),d.setFlag(h.V,~(t^i)&(t^r)&128)},l.prototype.upd_nz=function(t){d.setFlag(h.N,128&t),d.setFlag(h.Z,0==t)},l.prototype.cross=function(t,i){return(t+i&65280)!=(65280&t)},l.prototype.dma_oam=function(t){for(var i=0;i<256;i++)this.wr(8212,this.rd(256*t+i))},l.prototype.access=function(t,i,r=0){if(i<=8191)return t&&(y[i%2048]=r),y[i%2048];if(i>=8192&&i<=16383)return this.nes.ppu.access(t,i%8,r);if(i>=16384&&i<=16403);else if(16405==i);else if(16404==i)t&&this.dma_oam(r);else if(16407==i);else if(16406==i);else if(i>=16408&&i<=65535)return this.nes.cartridge.access(t,i,r);return 0},l.prototype.wr=function(t,i){return this.tick(),this.access(1,t,i)},l.prototype.rd=function(t){return this.tick(),this.access(0,t)},l.prototype.rd16_d=function(t,i){var r=new Uint16Array(1),s=new Uint16Array(1),e=new Uint16Array(1);return s[0]=this.rd(t),e[0]=this.rd(i)<<8,r[0]=s[0]|e[0],r[0]},l.prototype.rd16=function(t){return this.rd16_d(t,t+1)},l.prototype.push=function(t){return this.wr(256+u[0]--,t)},l.prototype.pop=function(t){var i=new Uint8Array(1);return i[0]=this.rd(++u[0]+256),i[0]},l.prototype.imm=function(){return f[0]++},l.prototype.imm16=function(){return f[0]+=2,f[0]-2},l.prototype.abs=function(){return this.rd16(this.imm16())},l.prototype._abx=function(){return this.tick(),this.abs()+c[0]},l.prototype.abx=function(){var t=this.abs();return this.cross(t,c[0])&&this.tick(),t+c[0]},l.prototype.aby=function(){var t=this.abs();return this.cross(t,p[0])&&this.tick(),t+p[0]},l.prototype.zp=function(){return this.rd(this.imm())},l.prototype.zpx=function(){return this.tick(),(this.zp()+c[0])%256},l.prototype.zpy=function(){return this.tick(),(this.zp()+p[0])%256},l.prototype.izx=function(){var t=this.zpx();return this.rd16_d(t,(t+1)%256)},l.prototype._izy=function(){var t=this.zp();return this.rd16_d(t,(t+1)%256)+p[0]},l.prototype.izy=function(){var t=this._izy();return this.cross(t-p[0],p[0])&&this.tick(),t},l.prototype.st=function(t,i){this.wr(i.bind(this)(),t)},l.prototype.st_A_izy=function(){this.tick(),this.wr(this._izy(),o[0])},l.prototype.st_A_abx=function(){this.tick(),this.wr(this.abs()+c[0],o[0])},l.prototype.st_A_aby=function(){this.tick(),this.wr(this.abs()+p[0],o[0])},l.prototype.ld=function(t,i){var r=new Uint16Array(1),s=new Uint8Array(1);r[0]=i(),s[0]=this.rd(r[0]),t[0]=s[0],this.upd_nz(s[0])},l.prototype.cmp=function(t,i){var r=new Uint16Array(1),s=new Uint8Array(1);r[0]=i(),s[0]=this.rd(r[0]),this.upd_nz(t-s[0]),d.setFlag(h.C,t>=s[0])},l.prototype.ADC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Int16Array(1);i[0]=t(),r[0]=this.rd(i[0]),s[0]=o[0]+r[0]+d.index(h.C),this.upd_cv(o[0],r[0],s[0]),this.upd_nz(o[0]=s[0])},l.prototype.SBC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Int16Array(1);i[0]=t(),r[0]=255^this.rd(i[0]),s[0]=o[0]+r[0]+d.index(h.C),this.upd_cv(o[0],r[0],s[0]),o[0]=s[0],this.upd_nz(o[0])},l.prototype.BIT=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),d.setFlag(h.Z,!(o[0]&r[0])),d.setFlag(h.N,128&r[0]),d.setFlag(h.V,64&r[0])},l.prototype.AND=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.upd_nz(o[0]&=r[0])},l.prototype.EOR=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.upd_nz(o[0]^=r[0])},l.prototype.ORA=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.upd_nz(o[0]|=r[0])},l.prototype.ASL=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),d.setFlag(h.C,128&r[0]),this.tick(),this.upd_nz(this.wr(i[0],r[0]<<1))},l.prototype.LSR=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),d.setFlag(h.C,1&r),this.tick(),this.upd_nz(this.wr(i[0],r[0]>>1))},l.prototype.ROL=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),s[0]=d.index(h.C),d.setFlag(h.C,128&r[0]),this.tick(),this.upd_nz(this.wr(i[0],r[0]<<1|s[0]))},l.prototype.ROR=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),s[0]=new Uint8Array(1),s[0]=d.index(h.C)<<7,d.setFlag(h.C,1&r[0]),this.tick(),this.upd_nz(this.wr(i[0],s[0]|r[0]>>1))},l.prototype.DEC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.tick(),this.upd_nz(this.wr(i[0],--r[0]))},l.prototype.INC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.tick(),this.upd_nz(this.wr(i[0],++r[0]))},l.prototype.dec=function(t){t[0]=t[0]-1,this.upd_nz(t[0]),this.tick()},l.prototype.inc=function(t){t[0]=t[0]+1,this.upd_nz(t[0]),this.tick()},l.prototype.ASL_A=function(){d.setFlag(h.C,128&o[0]),o[0]=o[0]<<=1,this.upd_nz(o[0]),this.tick()},l.prototype.LSR_A=function(){d.setFlag(h.C,1&o[0]),o[0]=o[0]>>1,this.upd_nz(o[0]),this.tick()},l.prototype.ROL_A=function(){var t=d.index(h.C);d.setFlag(h.C,128&o[0]),o[0]=o[0]<<1,o[0]=o[0]|t,this.upd_nz(o[0]),this.tick()},l.prototype.ROR_A=function(){var t=d.index(h.C)<<7&255;d.setFlag(h.C,1&o[0]),o[0]=o[0]>>1,this.upd_nz(o[0]=t|o[0]),this.tick()},l.prototype.tr=function(t,i){i[0]=t[0],this.upd_nz(i[0]),this.tick()},l.prototype.tr_X_S=function(){u[0]=c[0],this.tick()},l.prototype.PLP=function(){this.tick(),this.tick();var t=this.pop();d.set(t)},l.prototype.PHP=function(){this.tick(),this.push(16|d.get())},l.prototype.PLA=function(){this.tick(),this.tick(),o[0]=this.pop(),this.upd_nz(o[0])},l.prototype.PHA=function(){this.tick(),this.push(o[0])},l.prototype.br=function(t,i){var r=new Int8Array([this.rd(this.imm())]);d.index(t)==i&&(this.tick(),f[0]+=r[0])},l.prototype.JMP_IND=function(){var t=new Uint16Array(1);t[0]=this.rd16(this.imm16()),f[0]=this.rd16_d(t[0],65280&t[0]|(t[0]+1)%256)},l.prototype.JMP=function(){f[0]=this.rd16(this.imm16())},l.prototype.JSR=function(){var t=f[0]+1;this.tick(),this.push(t>>8),this.push(t),f[0]=this.rd16(this.imm16())},l.prototype.RTS=function(){this.tick(),this.tick(),f[0]=1+(this.pop()|this.pop()<<8),this.tick()},l.prototype.RTI=function(){this.PLP();var t=this.pop(),i=this.pop()<<8;f[0]=t|i},l.prototype.flag=function(t,i){d.setFlag(t,i),this.tick()},l.prototype.INT=function(t){this.tick(),t!=n&&this.tick(),t!=s?(this.push(f[0]>>8),this.push(255&f[0]),this.push(d.get()|(t==n)<<4)):(u[0]-=3,this.tick(),this.tick(),this.tick()),d.setFlag(h.I,!0);f[0]=this.rd16([65530,65532,65534,65534][t]),t==r&&(this.nmi=!1)},l.prototype.NOP=function(){this.tick()},l.prototype.exec=function(){switch(this.rd(f[0]++)){case 0:return this.INT(n);case 1:return this.ORA(this.izx.bind(this));case 5:return this.ORA(this.zp.bind(this));case 6:return this.ASL(this.zp.bind(this));case 8:return this.PHP();case 9:return this.ORA(this.imm.bind(this));case 10:return this.ASL_A();case 13:return this.ORA(this.abs.bind(this));case 14:return this.ASL(this.abs.bind(this));case 16:return this.br(h.N,0);case 17:return this.ORA(this.izy.bind(this));case 21:return this.ORA(this.zpx.bind(this));case 22:return this.ASL(this.zpx.bind(this));case 24:return this.flag(h.C,0);case 25:return this.ORA(this.aby.bind(this));case 29:return this.ORA(this.abx.bind(this));case 30:return this.ASL(this._abx.bind(this));case 32:return this.JSR();case 33:return tgis.AND(this.izx.bind(this));case 36:return this.BIT(this.zp.bind(this));case 37:return AND(this.zp.bind(this));case 38:return this.ROL(this.zp.bind(this));case 40:return this.PLP();case 41:return this.AND(this.imm.bind(this));case 42:return this.ROL_A();case 44:return this.BIT(this.abs.bind(this));case 45:return AND(this.abs);case 46:return this.ROL(this.abs.bind(this));case 48:return this.br(h.N,1);case 49:return this.AND(this.izy.bind(this));case 53:return this.AND(this.zpx.bind(this));case 54:return this.ROL(this.zpx.bind(this));case 56:return this.flag(h.C,1);case 57:return this.AND(this.aby.bind(this));case 61:return this.AND(this.abx.bind(this));case 62:return this.ROL(this._abx.bind(this));case 64:return this.RTI();case 65:return this.EOR(this.izx.bind(this));case 69:return this.EOR(this.zp.bind(this));case 70:return this.LSR(this.zp.bind(this));case 72:return this.PHA();case 73:return this.EOR(this.imm.bind(this));case 74:return this.LSR_A();case 76:return this.JMP();case 77:return this.EOR(this.abs.bind(this));case 78:return this.LSR(this.abs.bind(this));case 80:return this.br(h.V,0);case 81:return this.EOR(this.izy.bind(this));case 85:return this.EOR(this.zpx.bind(this));case 86:return this.LSR(this.zpx.bind(this));case 88:return this.flag(h.I,0);case 89:return this.EOR(this.aby.bind(this));case 93:return this.EOR(this.abx.bind(this));case 94:return this.LSR(this._abx.bind(this));case 96:return this.RTS();case 97:return this.ADC(this.izx.bind(this));case 101:return this.ADC(this.zp.bind(this));case 102:return this.ROR(this.zp.bind(this));case 104:return this.PLA();case 105:return this.ADC(this.imm);case 106:return this.ROR_A();case 108:return this.JMP_IND();case 109:return this.ADC(this.abs.bind(this));case 110:return this.ROR(this.abs.bind(this));case 112:return this.br(h.V,1);case 113:return this.ADC(this.izy.bind(this));case 117:return ADC(this.zpx.bind(this));case 118:return this.ROR(this.zpx);case 120:return this.flag(h.I,1);case 121:return this.ADC(this.aby.bind(this));case 125:return this.ADC(this.abx.bind(this));case 126:return this.ROR(this._abx.bind(this));case 129:return this.st(o[0],this.izx.bind(this));case 132:return this.st(p[0],this.zp.bind(this));case 133:return this.st(o[0],this.zp.bind(this));case 134:return this.st(c[0],this.zp.bind(this));case 136:return this.dec(p);case 138:return this.tr(c,o);case 140:return this.st(p[0],this.abs.bind(this));case 141:return this.st(o[0],this.abs.bind(this));case 142:return this.st(c[0],this.abs.bind(this));case 144:return this.br(h.C,0);case 145:return this.st_A_izy();case 148:return this.st(p[0],this.zpx.bind(this));case 149:return this.st(o[0],this.zpx.bind(this));case 150:return this.st(c[0],this.zpy.bind(this));case 152:return this.tr(p,o);case 153:return this.st_A_aby();case 154:return this.tr(c,u);case 157:return this.st_A_abx();case 160:return this.ld(p,this.imm.bind(this));case 161:return this.ld(o,this.izx.bind(this));case 162:return this.ld(c,this.imm.bind(this));case 164:return this.ld(p,this.zp.bind(this));case 165:return this.ld(o,this.zp.bind(this));case 166:return this.ld(c,this.zp.bind(this));case 168:return this.tr(o,p);case 169:return this.ld(o,this.imm.bind(this));case 170:return this.tr(o,c);case 172:return this.ld(p,this.abs.bind(this));case 173:return this.ld(o,this.abs.bind(this));case 174:return this.ld(c,this.abs.bind(this));case 176:return this.br(h.C,1);case 177:return this.ld(o,this.izy.bind(this));case 180:return this.ld(h.Y,this.zpx.bind(this));case 181:return this.ld(o,this.zpx.bind(this));case 182:return this.ld(h.X,this.zpy.bind(this));case 184:return this.flag(h.V,0);case 185:return this.ld(o,this.aby.bind(this));case 186:return this.tr(u,c);case 188:return this.ld(p,this.abx.bind(this));case 189:return this.ld(o,this.abx.bind(this));case 190:return this.ld(c,this.aby.bind(this));case 192:return this.cmp(p[0],this.imm.bind(this));case 193:return this.cmp(o[0],this.izx.bind(this));case 196:return this.cmp(p[0],this.zp.bind(this));case 197:return this.cmp(o[0],this.zp.bind(this));case 198:return this.DEC(this.zp.bind(this));case 200:return this.inc(p);case 201:return this.cmp(o[0],this.imm.bind(this));case 202:return this.dec(c);case 204:return this.cmp(p[0],this.abs.bind(this));case 205:return this.cmp(o[0],this.abs.bind(this));case 206:return this.DEC(this.abs.bind(this));case 208:return this.br(h.Z,0);case 209:return this.cmp(o[0],this.izy.bind(this));case 213:return this.cmp(o[0],this.zpx.bind(this));case 214:return this.DEC(this.zpx.bind(this));case 216:return this.flag(h.D,0);case 217:return this.cmp(o[0],this.aby.bind(this));case 221:return this.cmp(o[0],this.abx.bind(this));case 222:return this.DEC(this._abx.bind(this));case 224:return this.cmp(c[0],this.imm.bind(this));case 225:return this.SBC(this.izx.bind(this));case 228:return this.cmp(c[0],this.zp.bind(this));case 229:return SBC(this.zp.bind(this));case 230:return this.INC(this.zp.bind(this));case 232:return this.inc(c);case 233:return this.SBC(this.imm);case 234:return this.NOP();case 236:return this.cmp(c[0],this.abs.bind(this));case 237:return this.SBC(this.abs.bind(this));case 238:return this.INC(this.abs.bind(this));case 240:return this.br(h.Z,1);case 241:return this.SBC(this.izy);case 245:return this.SBC(this.zpx.bind(this));case 246:return this.INC(this.zpx.bind(this));case 248:return this.flag(h.D,1);case 249:return this.SBC(this.aby.bind(this));case 253:return this.SBC(this.abx.bind(this));case 254:return this.INC(this._abx.bind(this));default:return console.log(\"Invalid OPcode! PC:\",f[0],\" OOP:\",this.rd(f[0]-1)),this.NOP()}},l.prototype.power=function(){this.remaininhCycles=0,d.set(4),o[0]=0,c[0]=0,p[0]=0,u[0]=0,y.fill(255),this.nmi=!1,this.irq=!1,this.INT(s)},l.prototype.run_frame=function(){for(this.remaininhCycles+=29781;this.remaininhCycles>0;)this.nmi?this.INT(r):this.irq&&d.index(h.I)&&this.INT(e),this.exec()},t.exports=l},function(t,i){var r=0,s=1,e=2,n=3,h=0,a=1,o=[8158332,252,188,4466876,9699460,11010080,11014144,8918016,5255168,30720,26624,22528,16472,0,0,0,12369084,30968,22776,6833404,14155980,14942296,16267264,14965776,11303936,47104,43008,43076,34952,0,0,0,16316664,3980540,6850812,9992440,16283896,16275608,16283736,16556100,16300032,12122136,5822548,5830808,59608,7895160,0,0,16579836,10806524,12105976,14203128,16300280,16295104,15782064,16572584,16308344,14219384,12122296,12122328,64764,16308472,0,0],c=function(){this.id=0,this.x=0,this.y=0,this.tile=0,this.attr=0,this.dataL=0,this.dataH=0},p=function(){this.data=0};p.prototype.set_nt=function(t){t&=3,this.data&=-4,this.data|=t},p.prototype.get_nt=function(t){return 3&this.data},p.prototype.set_incr=function(t){this.data&=-5,this.data|=t<<2},p.prototype.get_incr=function(){return(4&this.data)>>2},p.prototype.set_sprTbl=function(t){this.data&=-9,this.data|=t<<3},p.prototype.get_sprTbl=function(){return(8&this.data)>>3},p.prototype.set_bgTbl=function(t){data&=-17,data|=t<<4},p.prototype.get_bgTbl=function(){return(16&this.data)>>4},p.prototype.set_sprSz=function(t){this.data&=-33,this.data|=t<<5},p.prototype.get_sprSz=function(){return(32&this.data)>>5},p.prototype.set_slave=function(t){this.data&=-65,this.data|=t<<6},p.prototype.get_slave=function(){return(32&v)>>6},p.prototype.set_nmi=function(t){this.data&=-129,this.data|=t<<7},p.prototype.get_nmi=function(){return(128&this.data)>>7},p.prototype.set_r=function(t){this.data=t},p.prototype.get_r=function(t){return this.data};var u=function(){this.data=0};u.prototype.set_gray=function(t){this.data&=-2,this.data|=t},u.prototype.get_gray=function(t){return 1&this.data},u.prototype.set_bgLeft=function(t){this.data&=-3,this.data|=t<<1},u.prototype.get_bgLeft=function(){return(2&this.data)>>1},u.prototype.set_sprLeft=function(t){this.data&=-5,this.data|=t<<2},u.prototype.get_sprLeft=function(){return(4&this.data)>>2},u.prototype.set_bg=function(t){this.data&=-9,this.data|=t<<3},u.prototype.get_bg=function(){return(8&this.data)>>3},u.prototype.set_spr=function(t){data&=-17,data|=t<<4},u.prototype.get_spr=function(){return(16&this.data)>>4},u.prototype.set_red=function(t){this.data&=-33,this.data|=t<<5},u.prototype.get_red=function(){return(32&this.data)>>5},u.prototype.set_green=function(t){this.data&=-65,this.data|=t<<6},u.prototype.get_green=function(){return(32&v)>>6},u.prototype.set_blue=function(t){this.data&=-129,this.data|=t<<7},u.prototype.get_blue=function(){return(128&this.data)>>7},u.prototype.set_r=function(t){this.data=t},u.prototype.get_r=function(t){return this.data};var d=function(){this.data=0};d.prototype.set_bus=function(t){t&=31,this.data&=~(31&t),this.data|=t},d.prototype.get_bus=function(){return 31&this.data},d.prototype.set_sprOvf=function(t){this.data&=-33,this.data|=t<<5},d.prototype.get_sprOvf=function(t){return(32&this.data)>>5},d.prototype.set_sprHit=function(t){this.data&=-65,this.data|=t<<6},d.prototype.get_sprHit=function(t){return(64&this.data)>>6},d.prototype.get_vBlank=function(t){return(128&this.data)>>7},d.prototype.set_vBlank=function(t){this.data&=-129,this.data|=t<<7},d.prototype.get_r=function(){return this.data},d.prototype.set_r=function(t){this.data=t};var f=function(){};f.prototype.set_cX=function(t){t&=31,this.data&=-32,this.data|=t},f.prototype.get_cX=function(t){return 31&this.data},f.prototype.set_cY=function(t){this.data&=-993,this.data|=t<<5&992},f.prototype.get_cY=function(){return(992&this.data)>>5},f.prototype.set_nt=function(t){this.data&=-3073,this.data|=t<<10&3072},f.prototype.get_nt=function(){return(3072&this.data)>>10},f.prototype.set_fY=function(t){this.data&=-28673,this.data|=t<<12&28672},f.prototype.get_fY=function(t){this.data|=(28672&t)>>12},f.prototype.set_l=function(t){t&=255,this.data&=-256,this.data|=t},f.prototype.get_l=function(t){return 255&this.data},f.prototype.set_h=function(t){this.data&=-32513,this.data|=t<<8&32512},f.prototype.get_h=function(){return(32512&this.data)>>8},f.prototype.set_addr=function(t){this.data&=16383,this.data|=16383},f.prototype.get_addr=function(){return 16383&this.data},f.prototype.set_r=function(t){this.data=t},f.prototype.get_r=function(){return this.data};var y=new Uint32Array(61440),l=new Uint8Array(2048),_=new Uint8Array(32),g=new Uint8Array(256),b=new Array(8),m=new Array(8),A=new f,w=new f,z=0,x=0,S=new p,R=new u,C=new d,k=0,O=0,U=0,L=0,I=0,P=0,D=0,F=0,T=0,N=0,B=0,E=0,Y=0;function H(){return R.get_bg()||R.get_spr()}function M(){return S.get_sprSz()?16:8}function X(){return 8192|4095&A.get_r()}function j(){D=65280&D|U,F=65280&F|L,T=1&O,N=2&O}function V(t,i){return t>>i&1}var q=function(t){this.nes=t};q.prototype.set_display=function(t){this.display=t},q.prototype.nt_mirror=function(t){switch(this.mirroring){case h:return t%2048;case a:return(t/2&1024)+t%1024;default:return t-8192}},q.prototype.debugInfo=function(){console.log(\"nt:\",k,\" at:\",O,\" bgL:\",U,\" bgH:\",L),console.log(\"atShiftL:\",I,\"atShiftH:\",P,\"bgShiftL:\",D,\"bgShiftH:\",F),console.log(\"atLatchL:\",T,\"atLatchH:\",N,\"scanline:\",B,\"dot:\",E,\"frameOdd:\",Y)},q.prototype.load_sprites=function(){for(var t,i=0;i<8;i++){b[i]=m[i],t=16==M()?4096*(1&b[i].tile)+16*(-2&b[i].tile):4096*S.sprTbl+16*b[i].tile;var r=(B-b[i].y)%M();128&b[i].attr&&(r^=M()-1),t+=r+(8&r),b[i].dataL=this.rd(t+0),b[i].dataH=this.rd(t+8)}},q.prototype.pixel=function(){var t=0,i=0,r=E-2;if(B<240&&r>=0&&r<256){if(!R.get_bg()||!R.get_bgLeft()&&r<8||(t=V(F,15-z)<<1|V(D,15-z))&&(t|=(V(P,7-z)<<1|V(I,7-z))<<2),R.get_spr()&&(R.get_sprLeft()||!(r<8)))for(var s=7;s>=0;s--)if(64!=b[s].id){var e=r-b[s].x;if(!(e>=8)){64&b[s].attr&&(e^=7);var n=V(b[s].dataH,7-e)<<1|V(b[s].dataL,7-e);0!=n&&(0==b[s].id&&t&&255!=r&&C.set_sprHit(!0),i=(n|=(3&b[s].attr)<<2)+16,objPriority=32&b[s].attr)}}!i||0!=t&&0!=objPriority||(t=i),y[256*B+r]=o[this.rd(16128+(H()?t:0))]}D<<=1,F<<=1,I=I<<1|T,P=P<<1|N};var Z=0;q.prototype.scanline_cycle=function(t){if(t==e&&1==E)C.set_vBlank(!0),S.get_nmi()&&this.nes.cpu.set_nmi();else if(t==s&&0==E)null!=this.display&&(console.log(this.display),this.display.draw(y));else if(t==r||t==n){switch(E){case 1:!function(){for(var t=0;t<8;t++)null==m[t]&&(m[t]=new c),m[t].id=64,m[t].y=255,m[t].tile=255,m[t].attr=255,m[t].x=255,m[t].dataL=0,m[t].dataH=0}(),t==n&&(C.set_sprOvf(!1),C.set_sprHit(!1));break;case 257:!function(){for(var t=0,i=0;i<64;i++){var r=(261==B?-1:B)-g[4*i+0];if(r>=0&&r<M()&&(null==m[t]&&(m[t]=new c),m[t].id=i,m[t].y=g[4*i+0],m[t].tile=g[4*i+1],m[t].attr=g[4*i+2],m[t].x=g[4*i+3],++t>8)){C.set_sprOvf(1);break}}}();break;case 321:this.load_sprites()}if(E>=2&&E<=255||E>=322&&E<=337)switch(this.pixel(),E%8){case 1:Z=X(),j();break;case 2:k=this.rd(Z);break;case 3:Z=9152|A.get_nt()<<10|A.get_cY()/4<<3|A.get_cX()/4;break;case 4:O=this.rd(Z),2&A.get_cY()&&(O>>=4),2&A.get_cX()&&(O>>=2);break;case 5:Z=4096*S.get_bgTbl()+16*k+A.get_fY();break;case 6:U=this.rd(Z);break;case 7:Z+=8;break;case 0:L=this.rd(Z),H()&&(31==A.get_cX()?A.set_r(1055^A.get_r()):A.set_cX(A.get_cX()+1))}else 256==E?(this.pixel(),L=this.rd(Z),H()&&(A.get_fY()<7?A.set_fY(A.get_fY()+1):(A.set_fY(0),31==A.get_cY()?A.set_cY(0):29==A.get_cY()?(A.set_cY(0),A.set_nt(2^A.get_nt())):A.set_cY(A.get_cY()+1)))):257==E?(this.pixel(),j(),H()&&A.set_r(-1056&A.get_r()|1055&w.get_r())):E>=280&&E<=304?t==n&&H()&&A.set_r(-31713&A.get_r()|31712&w.get_r()):1==E?(Z=X(),t==n&&C.set_vBlank(!1)):321==E||339==E?Z=X():338==E?k=this.rd(Z):340==E&&(k=this.rd(Z),t==n&&H()&&Y&&E++);260==E&&H()&&this.nes.cartridge.signal_scanline()}},q.prototype.rd=function(t){return t<=8191?this.nes.cartridge.chr_access(0,t):t>=8192&t<=16127?l[this.nt_mirror(t)]:t>=16128&&t<=16383?(16==(19&t)&&(t&=-17),_[31&t]&(R.get_gray?48:255)):0},q.prototype.wr=function(t,i){t<=8191?this.nes.cartridge.chr_access(1,t,i):t>=8192&&t<=16127?l[this.nt_mirror(t)]=i:t>=16128&&t<=16383&&(16==(19&t)&&(t&=-17),_[31&t]=i)},q.prototype.step=function(){B>=0&&B<=239?this.scanline_cycle(r):240==B?this.scanline_cycle(s):241==B?this.scanline_cycle(e):261==B&&this.scanline_cycle(n),++E>340&&(E%=341,++B>261&&(B=0,Y^=1))};var G=0,J=0,W=0;q.prototype.access=function(t,i,r){if(t)switch(ccess_res=r,i){case 0:S.set_r(r),w.set_nt(S.get_nt());break;case 1:R.set_r(r);break;case 3:x=r;break;case 4:g[x++]=r;break;case 5:W?(w.set_fY(7&r),w.set_cY(r>>3)):(z=7&r,w.set_cX(r>>3)),W=!W;break;case 6:W?(w.set_l(r),A.set_r(w.get_r())):w.set_h(63&r),W=!W;break;case 7:this.wr(A.get_addr,r),A.set_addr(A.get_addr()+S.get_incr()?32:1)}else switch(i){case 2:G=31&G|C.get_r(),C.set_vBlank(0),W=0;break;case 4:G=g[x];break;case 7:A.addr<=16127?(G=J,J=this.rd(A.get_addr())):G=J=this.rd(A.get_addr()),A.set_addr(A.get_addr()+S.get_incr()?32:1)}return G},q.prototype.reset=function(){Y=!1,B=E=0,S.set_r(0),R.set_r(0),C.set_r(0),y.fill(0),l.fill(255),g.fill(0)},q.prototype.set_mirroring_vertical=function(){this.mirroring=h},q.prototype.set_mirroring_horizontal=function(){this.mirroring=a},t.exports=q},function(t,i,r){var s=r(4),e=function(t){this.nes=t,this.mapper=null,this.rom=null};e.prototype.load=function(t){console.log(t),this.rom=t;let i=240&t[7]|t[6]>>4;switch(this.mapper=null,i){case 0:this.mapper=new s.Mapper0(this.nes,t),this.mapper.init()}this.nes.cpu.power(),this.nes.ppu.reset()},e.prototype.loadUrl=function(t){},e.prototype.access=function(t,i,r){return t?this.mapper.write(i,r):this.mapper.read(i)},e.prototype.chr_access=function(t,i,r){return t?this.mapper.chr_write(i,r):this.mapper.chr_read(i)},e.prototype.signal_scanline=function(){},t.exports=e},function(t,i){var r=function(t,i){this.prgMap=new Int32Array(4),this.chrMap=new Int32Array(4),this.nes=t,this.rom=i,this.prgSize=16384*i[4],this.chrSize=8192*i[5],this.prgRamSize=i[8]?8192*i[8]:8192,1&i[6]?t.ppu.set_mirroring_vertical():t.ppu.set_mirroring_horizontal(),console.log(i),this.prg=i.subarray(16),this.prgRam=new Int8Array(this.prgRamSize),this.prgSize>0?this.chr=i.subarray(16+this.prgSize):(this.chrRam=!0,this.chrSize=8192,this.chr=new Int8Array(this.chrSize))};r.prototype.read=function(t){return t>=32768?this.prg[this.prgMap[(t-32768)/8192|0]+(t-32768)%8192]:this.prgRam[t-24576]},r.prototype.write=function(t,i){return i},r.prototype.chr_read=function(t){return this.chr[this.chrMap[t/1024]+t%1024]},r.prototype.chr_write=function(t,i){return i},r.prototype.map_prg=function(t,i,r){r<0&&(r=this.prgSize/(1024*t)+r);for(var s=0;s<t/8;++s)this.prgMap[t/8*i+s]=(1024*t*r+8192*s)%this.prgSize},r.prototype.map_prg_32=function(t,i){this.map_prg(32,t,i)},r.prototype.map_prg_16=function(t,i){this.map_prg(16,t,i)},r.prototype.map_prg_16=function(t,i){this.map_prg(8,t,i)},r.prototype.map_chr=function(t,i,r){for(var s=0;s<t;++s)this.chrMap[t*i+s]=(1024*t*r+1024*s)%this.chrSize},r.prototype.map_chr_8=function(t,i){this.map_chr(8,t,i)},r.prototype.map_chr_4=function(t,i){this.map_chr(4,t,i)},r.prototype.map_chr_2=function(t,i){this.map_chr(2,t,i)},r.prototype.map_chr_1=function(t,i){this.map_chr(1,t,i)},r.prototype.signal_scanline=function(){};var s=function(t,i){r.call(this,t,i)};(s.prototype=Object.create(r.prototype)).init=function(){this.map_prg_32(0,0),this.map_chr_8(0,0)},s.prototype.constructor=s,t.exports={Mapper0:s}},function(t,i){function r(t){this.gl=t}r.prototype.createShader=function(t,i,r){var s=(t=this.gl).createShader(i);if(t.shaderSource(s,r),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS)){var e=t.getShaderInfoLog(s);return console.log(\"无法编译 WebGL 程序。 \\n\\n\"+e),t.deleteShader(s),null}return s},r.prototype.initShader=function(t,i){var r=this.createShader(this.gl,gl.VERTEX_SHADER,t),s=this.createShader(this.gl,gl.FRAGMENT_SHADER,i);if(!r||!s)return null;var e=this.gl.createProgram();if(!e)return null;if(this.gl.attachShader(e,r),this.gl.attachShader(e,s),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,gl.LINK_STATUS)){var n=this.gl.getProgramInfoLog(e);return console.log(\"链接程序失败：\"+n),this.gl.deleteProgram(e),this.gl.deleteShader(s),this.gl.deleteShader(r),null}this.gl.useProgram(e),this.program=e},r.prototype.draw=function(t){this.gl.viewport(0,0,gl.canvas.width,gl.canvas.height),this.gl.clear(gl.COLOR_BUFFER_BIT);var i=this.gl.program,r=this.gl.getAttribLocation(i,\"a_position\"),s=this.gl.getUniformLocation(i,\"u_matrix\"),e=(this.gl.getUniformLocation(i,\"u_texture\"),this.gl.createBuffer());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e);this.gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,gl.FLOAT,!1,0,0);var n=new Uint8Array(t);createSolidTexture(this.gl,n);var h=this.gl.canvas.width,a=this.gl.canvas.height,o=0/this.gl.canvas.width*2-1,c=0/this.gl.canvas.height*-2+1,p=h/this.gl.canvas.width*2,u=a/this.gl.canvas.height*-2;this.gl.uniformMatrix3fv(s,!1,[p,0,0,0,u,0,o,c,1]),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},r.prototype.init=function(){this.initShader(\"\\n    attribute vec2 a_position;\\n    uniform vec2 u_resolution;\\n    uniform mat3 u_matrix;\\n    varying vec2 v_texCoord;\\n      void main() {\\n          gl_Position = vec4(u_matrix * vec3(a_position, 1), 1);\\n          v_texCoord = a_position;\\n      }\\n   \",\"\\n    precision mediump float;\\n    uniform sampler2D u_image;\\n    varying vec2 v_texCoord;\\n\\n    void main() {\\n        gl_FragColor = texture2D(u_image, v_texCoord);\\n    } \\n  \"),this.gl.clearColor(0,0,0,1),this.gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),console.log(\"GL init\")},t.exports=r}]);","extractedComments":[]}