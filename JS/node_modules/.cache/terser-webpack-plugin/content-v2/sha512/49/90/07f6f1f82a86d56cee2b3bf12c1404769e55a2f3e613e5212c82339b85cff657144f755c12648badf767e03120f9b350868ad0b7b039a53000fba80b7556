{"code":"var fcgame=function(t){var i={};function r(s){if(i[s])return i[s].exports;var e=i[s]={i:s,l:!1,exports:{}};return t[s].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=t,r.c=i,r.d=function(t,i,s){r.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},r.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.t=function(t,i){if(1&i&&(t=r(t)),8&i)return t;if(4&i&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&i&&\"string\"!=typeof t)for(var e in t)r.d(s,e,function(i){return t[i]}.bind(null,e));return s},r.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(i,\"a\",i),i},r.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},r.p=\"\",r(r.s=0)}([function(t,i,r){\"use strict\";r.r(i),r.d(i,\"FC_Game\",(function(){return o})),r.d(i,\"FC_Display\",(function(){return c}));var s=r(1),e=r(2),n=r(3),a=r(5),h=function(){this.cpu=new s(this),this.ppu=new e(this),this.cartridge=new n(this)};function o(){return new h}function c(t){return new a(t)}h.prototype.loadFile=function(){},h.prototype.load=function(t){this.cartridge.load(t)},h.prototype.run=function(){setInterval(()=>{nes.cpu.run_frame()},1e3/60)},h.prototype.registerDisplay=function(t){this.ppu.set_display(t)},h.prototype.test=function(){console.log(\"Hello FC Game!\")}},function(t,i){var r=0,s=1,e=2,n=3,a=0,h=1,o=2,c=3,p=6,u=7,d=function(){this.flag=32};d.prototype.get=function(){return this.flag},d.prototype.index=function(t){return!!(this.flag>>t&1)},d.prototype.setFlag=function(t,i){this.flag&=~(1<<t),this.flag|=(i>0)<<t},d.prototype.set=function(t){this.flag=255&(32|t)};var y=new Uint8Array(1),f=new Uint8Array(1),_=new Uint8Array(1),l=new Uint8Array(1),g=new d,b=new Uint16Array(1),m=new Uint8Array(2048),A=function(t){this.nes=t,this.nmi=!1,this.irq=!1,this.remaininhCycles=0};A.prototype.debugInfo=function(){console.log(\"A:\",y[0],\" X\",f[0],\" Y\",_[0],\" S\",l[0]),console.log(\"PC:\",b[0]),console.log(\"flag(\",\"C:\",g.index(a),\"Z:\",g.index(h),\"I:\",g.index(o),\"D:\",g.index(c),\"V:\",g.index(p),\"N:\",g.index(u),\")\"),console.log(\"nmi:\",this.nmi),console.log(\"irq:\",this.irq),console.log(\"cycles:\",this.remaininhCycles),console.log(\"--------------------------------------------------\")},A.prototype.set_nmi=function(t=!0){this.nmi=nmi=t},A.prototype.set_irq=function(t=ture){this.irq=t},A.prototype.dmc_read=function(t){return this.access(0,t)},A.prototype.elapsed=function(){return 29781-this.remaininhCycles},A.prototype.tick=function(){this.nes.ppu.step(),this.nes.ppu.step(),this.nes.ppu.step(),this.remaininhCycles--},A.prototype.upd_cv=function(t,i,r){g.setFlag(a,r>255),g.setFlag(p,~(t^i)&(t^r)&128)},A.prototype.upd_nz=function(t){var i=new Uint8Array(1);i[0]=t,g.setFlag(u,128&i[0]),g.setFlag(h,0==i[0])},A.prototype.cross=function(t,i){return(t+i&65280)!=(65280&t)},A.prototype.dma_oam=function(t){for(var i=0;i<256;i++)this.wr(8212,this.rd(256*t+i))},A.prototype.access=function(t,i,r=0){if(i<=8191)return t&&(m[i%2048]=r),m[i%2048];if(i>=8192&&i<=16383)return this.nes.ppu.access(t,i%8,r);if(i>=16384&&i<=16403);else if(16405==i);else if(16404==i)t&&this.dma_oam(r);else if(16407==i);else if(16406==i);else if(i>=16408&&i<=65535)return this.nes.cartridge.access(t,i,r);return 0},A.prototype.wr=function(t,i){return this.tick(),this.access(1,t,i)},A.prototype.rd=function(t){return this.tick(),this.access(0,t)},A.prototype.rd16_d=function(t,i){var r=new Uint16Array(1),s=new Uint16Array(1),e=new Uint16Array(1);return s[0]=this.rd(t),e[0]=this.rd(i)<<8,r[0]=s[0]|e[0],r[0]},A.prototype.rd16=function(t){return this.rd16_d(t,t+1)},A.prototype.push=function(t){return this.wr(256+l[0]--,t)},A.prototype.pop=function(t){var i=new Uint8Array(1);return i[0]=this.rd(++l[0]+256),i[0]},A.prototype.imm=function(){return b[0]++},A.prototype.imm16=function(){return b[0]+=2,b[0]-2},A.prototype.abs=function(){return this.rd16(this.imm16())},A.prototype._abx=function(){return this.tick(),this.abs()+f[0]},A.prototype.abx=function(){var t=this.abs();return this.cross(t,f[0])&&this.tick(),t+f[0]},A.prototype.aby=function(){var t=this.abs();return this.cross(t,_[0])&&this.tick(),t+_[0]},A.prototype.zp=function(){return this.rd(this.imm())},A.prototype.zpx=function(){return this.tick(),(this.zp()+f[0])%256},A.prototype.zpy=function(){return this.tick(),(this.zp()+_[0])%256},A.prototype.izx=function(){var t=this.zpx();return this.rd16_d(t,(t+1)%256)},A.prototype._izy=function(){var t=this.zp();return this.rd16_d(t,(t+1)%256)+_[0]},A.prototype.izy=function(){var t=this._izy();return this.cross(t-_[0],_[0])&&this.tick(),t},A.prototype.st=function(t,i){this.wr(i.bind(this)(),t)},A.prototype.st_A_izy=function(){this.tick(),this.wr(this._izy(),y[0])},A.prototype.st_A_abx=function(){this.tick(),this.wr(this.abs()+f[0],y[0])},A.prototype.st_A_aby=function(){this.tick(),this.wr(this.abs()+_[0],y[0])},A.prototype.ld=function(t,i){var r=new Uint16Array(1),s=new Uint8Array(1);r[0]=i(),s[0]=this.rd(r[0]),t[0]=s[0],this.upd_nz(s[0])},A.prototype.cmp=function(t,i){var r=new Uint16Array(1),s=new Uint8Array(1);r[0]=i(),s[0]=this.rd(r[0]),this.upd_nz(t-s[0]),g.setFlag(a,t>=s[0])},A.prototype.ADC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Int16Array(1);i[0]=t(),r[0]=this.rd(i[0]),s[0]=y[0]+r[0]+g.index(a),this.upd_cv(y[0],r[0],s[0]),y[0]=s[0],this.upd_nz(y[0])},A.prototype.SBC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Int16Array(1);i[0]=t(),r[0]=255^this.rd(i[0]),s[0]=y[0]+r[0]+g.index(a),this.upd_cv(y[0],r[0],s[0]),y[0]=s[0],this.upd_nz(y[0])},A.prototype.BIT=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),g.setFlag(h,!(y[0]&r[0])),g.setFlag(u,128&r[0]),g.setFlag(p,64&r[0])},A.prototype.AND=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),y[0]&=r[0],this.upd_nz(y[0])},A.prototype.EOR=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.upd_nz(y[0]^=r[0])},A.prototype.ORA=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.upd_nz(y[0]|=r[0])},A.prototype.ASL=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),g.setFlag(a,128&r[0]),this.tick(),this.upd_nz(this.wr(i[0],r[0]<<1))},A.prototype.LSR=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),g.setFlag(a,1&r),this.tick(),this.upd_nz(this.wr(i[0],r[0]>>1))},A.prototype.ROL=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),s[0]=g.index(a),g.setFlag(a,128&r[0]),this.tick(),this.upd_nz(this.wr(i[0],r[0]<<1|s[0]))},A.prototype.ROR=function(t){var i=new Uint16Array(1),r=new Uint8Array(1),s=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),s[0]=new Uint8Array(1),s[0]=g.index(a)<<7,g.setFlag(a,1&r[0]),this.tick(),this.upd_nz(this.wr(i[0],s[0]|r[0]>>1))},A.prototype.DEC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.tick(),this.upd_nz(this.wr(i[0],--r[0]))},A.prototype.INC=function(t){var i=new Uint16Array(1),r=new Uint8Array(1);i[0]=t(),r[0]=this.rd(i[0]),this.tick(),this.upd_nz(this.wr(i[0],++r[0]))},A.prototype.dec=function(t){t[0]=t[0]-1,this.upd_nz(t[0]),this.tick()},A.prototype.inc=function(t){t[0]=t[0]+1,this.upd_nz(t[0]),this.tick()},A.prototype.ASL_A=function(){g.setFlag(a,128&y[0]),y[0]=y[0]<<=1,this.upd_nz(y[0]),this.tick()},A.prototype.LSR_A=function(){g.setFlag(a,1&y[0]),y[0]=y[0]>>1,this.upd_nz(y[0]),this.tick()},A.prototype.ROL_A=function(){var t=g.index(a);g.setFlag(a,128&y[0]),y[0]=y[0]<<1,y[0]=y[0]|t,this.upd_nz(y[0]),this.tick()},A.prototype.ROR_A=function(){var t=g.index(a)<<7&255;g.setFlag(a,1&y[0]),y[0]=y[0]>>1,this.upd_nz(y[0]=t|y[0]),this.tick()},A.prototype.tr=function(t,i){i[0]=t[0],this.upd_nz(i[0]),this.tick()},A.prototype.tr_X_S=function(){l[0]=f[0],this.tick()},A.prototype.PLP=function(){this.tick(),this.tick();var t=this.pop();g.set(t)},A.prototype.PHP=function(){this.tick(),this.push(16|g.get())},A.prototype.PLA=function(){this.tick(),this.tick(),y[0]=this.pop(),this.upd_nz(y[0])},A.prototype.PHA=function(){this.tick(),this.push(y[0])},A.prototype.br=function(t,i){var r=new Int8Array([this.rd(this.imm())]);g.index(t)==i&&(this.tick(),b[0]+=r[0])},A.prototype.JMP_IND=function(){var t=new Uint16Array(1);t[0]=this.rd16(this.imm16()),b[0]=this.rd16_d(t[0],65280&t[0]|(t[0]+1)%256)},A.prototype.JMP=function(){b[0]=this.rd16(this.imm16())},A.prototype.JSR=function(){var t=b[0]+1;this.tick(),this.push(t>>8),this.push(t),b[0]=this.rd16(this.imm16())},A.prototype.RTS=function(){this.tick(),this.tick(),b[0]=1+(this.pop()|this.pop()<<8),this.tick()},A.prototype.RTI=function(){this.PLP();var t=this.pop(),i=this.pop()<<8;b[0]=t|i},A.prototype.flag=function(t,i){g.setFlag(t,i),this.tick()},A.prototype.INT=function(t){this.tick(),t!=n&&this.tick(),t!=s?(this.push(b[0]>>8),this.push(255&b[0]),this.push(g.get()|(t==n)<<4)):(l[0]-=3,this.tick(),this.tick(),this.tick()),g.setFlag(o,!0);b[0]=this.rd16([65530,65532,65534,65534][t]),t==r&&(this.nmi=!1)},A.prototype.NOP=function(){this.tick()};A.prototype.exec=function(){switch(this.rd(b[0]++)){case 0:return this.INT(n);case 1:return this.ORA(this.izx.bind(this));case 5:return this.ORA(this.zp.bind(this));case 6:return this.ASL(this.zp.bind(this));case 8:return this.PHP();case 9:return this.ORA(this.imm.bind(this));case 10:return this.ASL_A();case 13:return this.ORA(this.abs.bind(this));case 14:return this.ASL(this.abs.bind(this));case 16:return this.br(u,0);case 17:return this.ORA(this.izy.bind(this));case 21:return this.ORA(this.zpx.bind(this));case 22:return this.ASL(this.zpx.bind(this));case 24:return this.flag(a,0);case 25:return this.ORA(this.aby.bind(this));case 29:return this.ORA(this.abx.bind(this));case 30:return this.ASL(this._abx.bind(this));case 32:return this.JSR();case 33:return this.AND(this.izx.bind(this));case 36:return this.BIT(this.zp.bind(this));case 37:return this.AND(this.zp.bind(this));case 38:return this.ROL(this.zp.bind(this));case 40:return this.PLP();case 41:return this.AND(this.imm.bind(this));case 42:return this.ROL_A();case 44:return this.BIT(this.abs.bind(this));case 45:return this.AND(this.abs.bind(this));case 46:return this.ROL(this.abs.bind(this));case 48:return this.br(u,1);case 49:return this.AND(this.izy.bind(this));case 53:return this.AND(this.zpx.bind(this));case 54:return this.ROL(this.zpx.bind(this));case 56:return this.flag(a,1);case 57:return this.AND(this.aby.bind(this));case 61:return this.AND(this.abx.bind(this));case 62:return this.ROL(this._abx.bind(this));case 64:return this.RTI();case 65:return this.EOR(this.izx.bind(this));case 69:return this.EOR(this.zp.bind(this));case 70:return this.LSR(this.zp.bind(this));case 72:return this.PHA();case 73:return this.EOR(this.imm.bind(this));case 74:return this.LSR_A();case 76:return this.JMP();case 77:return this.EOR(this.abs.bind(this));case 78:return this.LSR(this.abs.bind(this));case 80:return this.br(p,0);case 81:return this.EOR(this.izy.bind(this));case 85:return this.EOR(this.zpx.bind(this));case 86:return this.LSR(this.zpx.bind(this));case 88:return this.flag(o,0);case 89:return this.EOR(this.aby.bind(this));case 93:return this.EOR(this.abx.bind(this));case 94:return this.LSR(this._abx.bind(this));case 96:return this.RTS();case 97:return this.ADC(this.izx.bind(this));case 101:return this.ADC(this.zp.bind(this));case 102:return this.ROR(this.zp.bind(this));case 104:return this.PLA();case 105:return this.ADC(this.imm);case 106:return this.ROR_A();case 108:return this.JMP_IND();case 109:return this.ADC(this.abs.bind(this));case 110:return this.ROR(this.abs.bind(this));case 112:return this.br(p,1);case 113:return this.ADC(this.izy.bind(this));case 117:return this.ADC(this.zpx.bind(this));case 118:return this.ROR(this.zpx);case 120:return this.flag(o,1);case 121:return this.ADC(this.aby.bind(this));case 125:return this.ADC(this.abx.bind(this));case 126:return this.ROR(this._abx.bind(this));case 129:return this.st(y[0],this.izx.bind(this));case 132:return this.st(_[0],this.zp.bind(this));case 133:return this.st(y[0],this.zp.bind(this));case 134:return this.st(f[0],this.zp.bind(this));case 136:return this.dec(_);case 138:return this.tr(f,y);case 140:return this.st(_[0],this.abs.bind(this));case 141:return this.st(y[0],this.abs.bind(this));case 142:return this.st(f[0],this.abs.bind(this));case 144:return this.br(a,0);case 145:return this.st_A_izy();case 148:return this.st(_[0],this.zpx.bind(this));case 149:return this.st(y[0],this.zpx.bind(this));case 150:return this.st(f[0],this.zpy.bind(this));case 152:return this.tr(_,y);case 153:return this.st_A_aby();case 154:return this.tr(f,l);case 157:return this.st_A_abx();case 160:return this.ld(_,this.imm.bind(this));case 161:return this.ld(y,this.izx.bind(this));case 162:return this.ld(f,this.imm.bind(this));case 164:return this.ld(_,this.zp.bind(this));case 165:return this.ld(y,this.zp.bind(this));case 166:return this.ld(f,this.zp.bind(this));case 168:return this.tr(y,_);case 169:return this.ld(y,this.imm.bind(this));case 170:return this.tr(y,f);case 172:return this.ld(_,this.abs.bind(this));case 173:return this.ld(y,this.abs.bind(this));case 174:return this.ld(f,this.abs.bind(this));case 176:return this.br(a,1);case 177:return this.ld(y,this.izy.bind(this));case 180:return this.ld(_,this.zpx.bind(this));case 181:return this.ld(y,this.zpx.bind(this));case 182:return this.ld(f,this.zpy.bind(this));case 184:return this.flag(p,0);case 185:return this.ld(y,this.aby.bind(this));case 186:return this.tr(l,f);case 188:return this.ld(_,this.abx.bind(this));case 189:return this.ld(y,this.abx.bind(this));case 190:return this.ld(f,this.aby.bind(this));case 192:return this.cmp(_[0],this.imm.bind(this));case 193:return this.cmp(y[0],this.izx.bind(this));case 196:return this.cmp(_[0],this.zp.bind(this));case 197:return this.cmp(y[0],this.zp.bind(this));case 198:return this.DEC(this.zp.bind(this));case 200:return this.inc(_);case 201:return this.cmp(y[0],this.imm.bind(this));case 202:return this.dec(f);case 204:return this.cmp(_[0],this.abs.bind(this));case 205:return this.cmp(y[0],this.abs.bind(this));case 206:return this.DEC(this.abs.bind(this));case 208:return this.br(h,0);case 209:return this.cmp(y[0],this.izy.bind(this));case 213:return this.cmp(y[0],this.zpx.bind(this));case 214:return this.DEC(this.zpx.bind(this));case 216:return this.flag(c,0);case 217:return this.cmp(y[0],this.aby.bind(this));case 221:return this.cmp(y[0],this.abx.bind(this));case 222:return this.DEC(this._abx.bind(this));case 224:return this.cmp(f[0],this.imm.bind(this));case 225:return this.SBC(this.izx.bind(this));case 228:return this.cmp(f[0],this.zp.bind(this));case 229:return this.SBC(this.zp.bind(this));case 230:return this.INC(this.zp.bind(this));case 232:return this.inc(f);case 233:return this.SBC(this.imm);case 234:return this.NOP();case 236:return this.cmp(f[0],this.abs.bind(this));case 237:return this.SBC(this.abs.bind(this));case 238:return this.INC(this.abs.bind(this));case 240:return this.br(h,1);case 241:return this.SBC(this.izy);case 245:return this.SBC(this.zpx.bind(this));case 246:return this.INC(this.zpx.bind(this));case 248:return this.flag(c,1);case 249:return this.SBC(this.aby.bind(this));case 253:return this.SBC(this.abx.bind(this));case 254:return this.INC(this._abx.bind(this));default:return console.log(\"Invalid OPcode! PC:\",b[0],\" OOP:\",this.rd(b[0]-1)),this.NOP()}},A.prototype.power=function(){this.remaininhCycles=0,g.set(4),y[0]=0,f[0]=0,_[0]=0,l[0]=0,m.fill(255),this.nmi=!1,this.irq=!1,this.INT(s)},A.prototype.run_frame=function(){for(0,this.remaininhCycles+=29781;this.remaininhCycles>0;)this.nmi?this.INT(r):this.irq&&g.index(o)&&this.INT(e),this.exec()},t.exports=A},function(t,i){var r=0,s=1,e=2,n=3,a=0,h=1,o=[4286348412,4278190332,4278190268,4282656956,4287889540,4289200160,4289204224,4287108096,4283445248,4278220800,4278216704,4278212608,4278206552,4278190080,4278190080,4278190080,4290559164,4278221048,4278212856,4285023484,4292346060,4293132376,4294457344,4293155856,4289494016,4278237184,4278233088,4278233156,4278225032,4278190080,4278190080,4278190080,4294506744,4282170620,4285040892,4288182520,4294473976,4294465688,4294473816,4294746180,4294490112,4290312216,4284012628,4284020888,4278249688,4286085240,4278190080,4278190080,4294769916,4288996604,4290296056,4292393208,4294490360,4294485184,4293972144,4294762664,4294498424,4292409464,4290312376,4290312408,4278254844,4294498552,4278190080,4278190080],c=function(){this.id=new Uint8Array(1),this.x=new Uint8Array(1),this.y=new Uint8Array(1),this.tile=new Uint8Array(1),this.attr=new Uint8Array(1),this.dataL=new Uint8Array(1),this.dataH=new Uint8Array(1)},p=function(){this.data=0};p.prototype.set_nt=function(t){t&=3,this.data&=-4,this.data|=t},p.prototype.get_nt=function(t){return 3&this.data},p.prototype.set_incr=function(t){this.data&=-5,this.data|=t<<2},p.prototype.get_incr=function(){return(4&this.data)>>2},p.prototype.set_sprTbl=function(t){this.data&=-9,this.data|=t<<3},p.prototype.get_sprTbl=function(){return(8&this.data)>>3},p.prototype.set_bgTbl=function(t){data&=-17,data|=t<<4},p.prototype.get_bgTbl=function(){return(16&this.data)>>4},p.prototype.set_sprSz=function(t){this.data&=-33,this.data|=t<<5},p.prototype.get_sprSz=function(){return(32&this.data)>>5},p.prototype.set_slave=function(t){this.data&=-65,this.data|=t<<6},p.prototype.get_slave=function(){return(32&v)>>6},p.prototype.set_nmi=function(t){this.data&=-129,this.data|=t<<7},p.prototype.get_nmi=function(){return(128&this.data)>>7},p.prototype.set_r=function(t){this.data=t},p.prototype.get_r=function(t){return this.data};var u=function(){this.data=0};u.prototype.set_gray=function(t){this.data&=-2,this.data|=t},u.prototype.get_gray=function(t){return 1&this.data},u.prototype.set_bgLeft=function(t){this.data&=-3,this.data|=t<<1},u.prototype.get_bgLeft=function(){return(2&this.data)>>1},u.prototype.set_sprLeft=function(t){this.data&=-5,this.data|=t<<2},u.prototype.get_sprLeft=function(){return(4&this.data)>>2},u.prototype.set_bg=function(t){this.data&=-9,this.data|=t<<3},u.prototype.get_bg=function(){return(8&this.data)>>3},u.prototype.set_spr=function(t){data&=-17,data|=t<<4},u.prototype.get_spr=function(){return(16&this.data)>>4},u.prototype.set_red=function(t){this.data&=-33,this.data|=t<<5},u.prototype.get_red=function(){return(32&this.data)>>5},u.prototype.set_green=function(t){this.data&=-65,this.data|=t<<6},u.prototype.get_green=function(){return(64&v)>>6},u.prototype.set_blue=function(t){this.data&=-129,this.data|=t<<7},u.prototype.get_blue=function(){return(128&this.data)>>7},u.prototype.set_r=function(t){this.data=t},u.prototype.get_r=function(t){return this.data};var d=function(){this.data=0};d.prototype.set_bus=function(t){t&=31,this.data&=~(31&t),this.data|=t},d.prototype.get_bus=function(){return 31&this.data},d.prototype.set_sprOvf=function(t){this.data&=-33,this.data|=t<<5},d.prototype.get_sprOvf=function(t){return(32&this.data)>>5},d.prototype.set_sprHit=function(t){this.data&=-65,this.data|=t<<6},d.prototype.get_sprHit=function(t){return(64&this.data)>>6},d.prototype.get_vBlank=function(t){return(128&this.data)>>7},d.prototype.set_vBlank=function(t){this.data&=-129,this.data|=t<<7},d.prototype.get_r=function(){return this.data},d.prototype.set_r=function(t){this.data=t};var y=function(){this.data=0};y.prototype.set_cX=function(t){t&=31,this.data&=-32,this.data|=t},y.prototype.get_cX=function(t){return 31&this.data},y.prototype.set_cY=function(t){this.data&=-993,this.data|=t<<5&992},y.prototype.get_cY=function(){return(992&this.data)>>5},y.prototype.set_nt=function(t){this.data&=-3073,this.data|=t<<10&3072},y.prototype.get_nt=function(){return(3072&this.data)>>10},y.prototype.set_fY=function(t){this.data&=-28673,this.data|=t<<12&28672},y.prototype.get_fY=function(){return(28672&this.data)>>12},y.prototype.set_l=function(t){t&=255,this.data&=-256,this.data|=t},y.prototype.get_l=function(t){return 255&this.data},y.prototype.set_h=function(t){this.data&=-32513,this.data|=t<<8&32512},y.prototype.get_h=function(){return(32512&this.data)>>8},y.prototype.set_addr=function(t){t&=16383,this.data&=-16384,this.data|=t},y.prototype.get_addr=function(){return 16383&this.data},y.prototype.set_r=function(t){this.data=t},y.prototype.get_r=function(){return this.data},(new y).set_fY(10);var f=new Uint32Array(61440),_=new Uint8Array(2048),l=new Uint8Array(32),g=new Uint8Array(256),b=new Array(8),m=new Array(8),A=new y,w=new y,z=0,x=new Uint8Array(1),R=new p,U=new u,S=new d,k=0,T=0,O=0,E=0,L=new Uint8Array(1),C=new Uint8Array(1),P=new Uint16Array(1),D=new Uint16Array(1),I=!1,F=!1,N=0,B=0,Y=0,M=0,X=new Uint16Array(1),H=new Uint16Array(1),G=new Uint16Array(1),j=new Uint16Array(1);function J(){return U.get_bg()||U.get_spr()}function q(){return R.get_sprSz()?16:8}function W(){return 8192|4095&A.get_r()}function V(){P[0]=65280&P[0]|O,D[0]=65280&D[0]|E,I=1&T,F=2&T}function K(t,i){return t>>i&1}var Z=function(t){this.nes=t};Z.prototype.set_display=function(t){this.display=t},Z.prototype.nt_mirror=function(t){switch(this.mirroring){case a:return t%2048;case h:return(t/2&1024)+t%1024;default:return t-8192}},Z.prototype.debugInfo=function(){console.log(\"nt:\",k,\" at:\",T,\" bgL:\",O,\" bgH:\",E,\"vAddr:\",A.get_r(),\"mask:\",U.get_r(),\"status:\",S.get_r()),console.log(\"atShiftL:\",L[0],\"atShiftH:\",C[0],\"bgShiftL:\",P[0],\"bgShiftH:\",D[0]),console.log(\"atLatchL:\",I>0,\"atLatchH:\",F>0,\"scanline:\",N,\"dot:\",B,\"frameOdd:\",Y>0)},Z.prototype.debugPixels=function(){console.log(f[0]+\"   \"+f[1])},Z.prototype.load_sprites=function(){for(var t,i=0;i<8;i++){b[i]=JSON.parse(JSON.stringify(m[i])),t=16==q()?4096*(1&b[i].tile[0])+16*(-2&b[i].tile[0]):4096*R.get_sprTbl()+16*b[i].tile[0];var r=new Uint8Array[0];r[0]=(N-b[i].y[0])%q(),128&b[i].attr[0]&&(r[0]^=q()-1),console.log(r[0]),t+=r[0]+(8&r[0]),b[i].dataL[0]=this.rd(t+0),b[i].dataH[0]=this.rd(t+8)}},Z.prototype.pixel=function(){var t=0,i=0,r=B-2;if(N<240&&r>=0&&r<256){if(!U.get_bg()||!U.get_bgLeft()&&r<8||(t=K(D[0],15-z)<<1|K(P[0],15-z))&&(t|=(K(C[0],7-z)<<1|K(L[0],7-z))<<2),U.get_spr()&&(U.get_sprLeft()||!(r<8)))for(var s=7;s>=0;s--)if(64!=b[s].id[0]){var e=r-b[s].x[0];if(!(e>=8)){64&b[s].attr[0]&&(e^=7);var n=K(b[s].dataH[0],7-e)<<1|K(b[s].dataL[0],7-e);0!=n&&(0==b[s].id[0]&&t&&255!=r&&S.set_sprHit(!0),i=(n|=(3&b[s].attr[0])<<2)+16,objPriority=32&b[s].attr[0])}}!i||0!=t&&0!=objPriority||(t=i),f[256*N+r]=o[this.rd(16128+(J()?t:0))]}P[0]<<=1,D[0]<<=1,L[0]=L[0]<<1|I>0,C[0]=C[0]<<1|F>0},Z.prototype.scanline_cycle=function(t){switch(t){case e:M=G;break;case s:M=H;break;case r:M=X;break;case n:M=j}if(t==e&&1==B)S.set_vBlank(!0),R.get_nmi()&&this.nes.cpu.set_nmi();else if(t==s&&0==B)null!=this.display&&this.display.draw(f);else if(t==r||t==n){switch(B){case 1:!function(){console.log(\"clear\");for(var t=0;t<8;t++)null==m[t]&&(m[t]=new c),m[t].id[0]=64,m[t].y[0]=255,m[t].tile[0]=255,m[t].attr[0]=255,m[t].x[0]=255,m[t].dataL[0]=0,m[t].dataH[0]=0}(),t==n&&(S.set_sprOvf(!1),S.set_sprHit(!1));break;case 257:!function(){for(var t=0,i=0;i<64;i++){var r=(261==N?-1:N)-g[4*i+0];if(r>=0&&r<q()&&(null==m[t]&&(m[t]=new c),m[t].id[0]=i,m[t].y[0]=g[4*i+0],m[t].tile[0]=g[4*i+1],m[t].attr[0]=g[4*i+2],m[t].x[0]=g[4*i+3],++t>8)){S.set_sprOvf(1);break}}}();break;case 321:this.load_sprites()}if(B>=2&&B<=255||B>=322&&B<=337)switch(this.pixel(),B%8){case 1:M[0]=W(),V();break;case 2:k=this.rd(M[0]);break;case 3:M[0]=9152|A.get_nt()<<10|A.get_cY()/4<<3|A.get_cX()/4;break;case 4:T=this.rd(M[0]),2&A.get_cY()&&(T>>=4),2&A.get_cX()&&(T>>=2);break;case 5:M[0]=4096*R.get_bgTbl()+16*k+A.get_fY();break;case 6:O=this.rd(M[0]);break;case 7:M[0]+=8;break;case 0:E=this.rd(M[0]),J()&&(31==A.get_cX()?A.set_r(1055^A.get_r()):A.set_cX(A.get_cX()+1))}else 256==B?(this.pixel(),E=this.rd(M[0]),J()&&(A.get_fY()<7?A.set_fY(A.get_fY()+1):(A.set_fY(0),31==A.get_cY()?A.set_cY(0):29==A.get_cY()?(A.set_cY(0),A.set_nt(2^A.get_nt())):A.set_cY(A.get_cY()+1)))):257==B?(this.pixel(),V(),J()&&A.set_r(-1056&A.get_r()|1055&w.get_r())):B>=280&&B<=304?t==n&&J()&&A.set_r(-31713&A.get_r()|31712&w.get_r()):1==B?(M[0]=W(),t==n&&S.set_vBlank(!1)):321==B||339==B?M[0]=W():338==B?k=this.rd(M[0]):340==B&&(k=this.rd(M[0]),t==n&&J()&&Y&&B++);260==B&&J()&&this.nes.cartridge.signal_scanline()}},Z.prototype.rd=function(t){return t<=8191?this.nes.cartridge.chr_access(0,t):t>=8192&t<=16127?_[this.nt_mirror(t)]:t>=16128&&t<=16383?(16==(19&t)&&(t&=-17),l[31&t]&(U.get_gray()?48:255)):0},Z.prototype.wr=function(t,i){t<=8191?this.nes.cartridge.chr_access(1,t,i):t>=8192&&t<=16127?_[this.nt_mirror(t)]=i:t>=16128&&t<=16383&&(16==(19&t)&&(t&=-17),l[31&t]=i)},Z.prototype.step=function(){N>=0&&N<=239?this.scanline_cycle(r):240==N?this.scanline_cycle(s):241==N?this.scanline_cycle(e):261==N&&this.scanline_cycle(n),++B>340&&(B%=341,++N>261&&(N=0,Y^=1))};var Q=new Uint8Array(1),$=new Uint8Array(1),tt=new Uint8Array(1),it=new Uint8Array(1),rt=new Uint8Array(1),st=new Uint8Array(1),et=0,nt=0,at=0;Z.prototype.access=function(t,i,r){if(t)switch(at=rt,nt=tt,(et=Q)[0]=r,i){case 0:R.set_r(r),w.set_nt(R.get_nt());break;case 1:U.set_r(r);break;case 3:x[0]=r;break;case 4:g[x[0]++]=r;break;case 5:at[0]?(w.set_fY(7&r),w.set_cY(r>>3)):(z=7&r,w.set_cX(r>>3)),at[0]=!at[0];break;case 6:at[0]?(w.set_l(r),A.set_r(w.get_r())):w.set_h(63&r),at[0]=!at[0];break;case 7:this.wr(A.get_addr(),r),A.set_addr(A.get_addr()+(R.get_incr()?32:1))}else switch(et=$,at=st,nt=it,i){case 2:et[0]=31&et[0]|S.get_r(),S.set_vBlank(0),at[0]=0;break;case 4:et[0]=g[x[0]];break;case 7:A.get_addr()<=16127?(et[0]=nt[0],nt[0]=this.rd(A.get_addr())):et[0]=nt[0]=this.rd(A.get_addr()),A.set_addr(A.get_addr()+(R.get_incr()?32:1))}return et[0]},Z.prototype.reset=function(){Y=!1,N=B=0,R.set_r(0),U.set_r(0),S.set_r(0),f.fill(0),_.fill(255),g.fill(0);for(var t=0;t<8;++t)m[t]=new c},Z.prototype.set_mirroring_vertical=function(){this.mirroring=a},Z.prototype.set_mirroring_horizontal=function(){this.mirroring=h},t.exports=Z},function(t,i,r){var s=r(4),e=function(t){this.nes=t,this.mapper=null,this.rom=null};e.prototype.load=function(t){this.rom=t;let i=240&t[7]|t[6]>>4;switch(this.mapper=null,i){case 0:this.mapper=new s.Mapper0(this.nes,t),this.mapper.init()}this.nes.cpu.power(),this.nes.ppu.reset()},e.prototype.loadUrl=function(t){},e.prototype.access=function(t,i,r){return t?this.mapper.write(i,r):this.mapper.read(i)},e.prototype.chr_access=function(t,i,r){return t?this.mapper.chr_write(i,r):this.mapper.chr_read(i)},e.prototype.signal_scanline=function(){},t.exports=e},function(t,i){var r=function(t,i){this.prgMap=new Int32Array(4),this.chrMap=new Int32Array(8),this.nes=t,this.rom=i,this.prgSize=16384*i[4],this.chrSize=8192*i[5],this.prgRamSize=i[8]?8192*i[8]:8192,1&i[6]?t.ppu.set_mirroring_vertical():t.ppu.set_mirroring_horizontal(),this.prg=i.subarray(16),this.prgRam=new Int8Array(this.prgRamSize),this.prgSize>0?this.chr=i.subarray(16+this.prgSize):(this.chrRam=!0,this.chrSize=8192,this.chr=new Int8Array(this.chrSize))};r.prototype.read=function(t){return t>=32768?this.prg[this.prgMap[(t-32768)/8192|0]+(t-32768)%8192]:this.prgRam[t-24576]},r.prototype.write=function(t,i){return i},r.prototype.chr_read=function(t){var i=this.chrMap[t/1024|0]+t%1024;return this.chr[i]},r.prototype.chr_write=function(t,i){return i},r.prototype.map_prg=function(t,i,r){r<0&&(r=this.prgSize/(1024*t)+r);for(var s=0;s<t/8;++s)this.prgMap[t/8*i+s]=(1024*t*r+8192*s)%this.prgSize},r.prototype.map_prg_32=function(t,i){this.map_prg(32,t,i)},r.prototype.map_prg_16=function(t,i){this.map_prg(16,t,i)},r.prototype.map_prg_16=function(t,i){this.map_prg(8,t,i)},r.prototype.map_chr=function(t,i,r){for(var s=0;s<t;++s)this.chrMap[t*i+s]=(1024*t*r+1024*s)%this.chrSize},r.prototype.map_chr_8=function(t,i){this.map_chr(8,t,i)},r.prototype.map_chr_4=function(t,i){this.map_chr(4,t,i)},r.prototype.map_chr_2=function(t,i){this.map_chr(2,t,i)},r.prototype.map_chr_1=function(t,i){this.map_chr(1,t,i)},r.prototype.signal_scanline=function(){};var s=function(t,i){r.call(this,t,i)};(s.prototype=Object.create(r.prototype)).init=function(){this.map_prg_32(0,0),this.map_chr_8(0,0)},s.prototype.constructor=s,t.exports={Mapper0:s}},function(t,i){function r(t){this.gl=t}r.prototype.createShader=function(t,i,r){var s=(t=this.gl).createShader(i);if(t.shaderSource(s,r),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS)){var e=t.getShaderInfoLog(s);return console.log(\"无法编译 WebGL 程序。 \\n\\n\"+e),t.deleteShader(s),null}return s},r.prototype.initShader=function(t,i){var r=this.createShader(this.gl,this.gl.VERTEX_SHADER,t),s=this.createShader(this.gl,this.gl.FRAGMENT_SHADER,i);if(!r||!s)return null;var e=this.gl.createProgram();if(!e)return null;if(this.gl.attachShader(e,r),this.gl.attachShader(e,s),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,gl.LINK_STATUS)){var n=this.gl.getProgramInfoLog(e);return console.log(\"链接程序失败：\"+n),this.gl.deleteProgram(e),this.gl.deleteShader(s),this.gl.deleteShader(r),null}this.gl.useProgram(e),this.program=e},r.prototype.draw=function(t){var i=this.gl;this.gl.viewport(0,0,i.canvas.width,i.canvas.height),this.gl.clear(i.COLOR_BUFFER_BIT);var r=this.program,s=this.gl.getAttribLocation(r,\"a_position\"),e=this.gl.getUniformLocation(r,\"u_matrix\"),n=(this.gl.getUniformLocation(r,\"u_texture\"),this.gl.createBuffer());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n);this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,0,0);var a=new Uint8Array(t.buffer);this.createSolidTexture(this.gl,a);var h=this.gl.canvas.width,o=this.gl.canvas.height,c=0/this.gl.canvas.width*2-1,p=0/this.gl.canvas.height*-2+1,u=h/this.gl.canvas.width*2,d=o/this.gl.canvas.height*-2;this.gl.uniformMatrix3fv(e,!1,[u,0,0,0,d,0,c,p,1]),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},r.prototype.createSolidTexture=function(t,i){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.canvas.width,t.canvas.height,0,t.RGBA,t.UNSIGNED_BYTE,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r},r.prototype.init=function(){this.initShader(\"\\n    attribute vec2 a_position;\\n    uniform vec2 u_resolution;\\n    uniform mat3 u_matrix;\\n    varying vec2 v_texCoord;\\n      void main() {\\n          gl_Position = vec4(u_matrix * vec3(a_position, 1), 1);\\n          v_texCoord = a_position;\\n      }\\n   \",\"\\n    precision mediump float;\\n    uniform sampler2D u_image;\\n    varying vec2 v_texCoord;\\n\\n    void main() {\\n        gl_FragColor = texture2D(u_image, v_texCoord);\\n    } \\n  \"),this.gl.clearColor(0,0,0,1),this.gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),console.log(\"GL init\")},t.exports=r}]);","extractedComments":[]}